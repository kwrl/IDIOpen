{% extends "admin/app_index.html" %}

{# {% load link_tags %} #}
{# {% contest as contest %} #}

{% load i18n %}

<h3>{% blocktrans with filter_title=title %} By {{ filter_title }} {% endblocktrans %}</h3>
<ul>
{% for choice in choices %}
    <li{% if choice.selected %} class="selected"{% endif %}>
    <a href="{{ choice.query_string|iriencode }}">{{ choice.display }}</a></li>
{% endfor %}
</ul>




{% block content %}

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://code.jquery.com/jquery.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>

<!-- Tablesorter css -->
<link href="/static/openshift/css/tablesorter/tablestyle.css" rel="stylesheet">
<!--  Tablesorter and tooltip js -->
<script type="text/javascript" src="/static/openshift/js/tablesorter/jquery.tablesorter.js"></script> 
<script type="text/javascript" src="/static/openshift/js/tooltip.js"></script> 

<h1>Submissions Overview</h1>

<small>Click on a table column to sort on that field</small>
<br />
<br />
<h3> Unsolved, onsite teams </h3>
<hr />
<table id="tableUnsolved_onsite" class="table table-bordered table-hover table-condensed tablesorter">
	<thead>
            <tr>
            <th data-toggle="tooltip" data-placement="top" title="The team this regards">Team</th>
            <th data-toggle="tooltip" data-placement="top" title="">Previously Solved Assignments</th>
            <th data-toggle="tooltip" data-placement="top" title="What problem this is about">Problem</th>
            <th data-toggle="tooltip" data-placement="top" title="Number of failed attempts">Failed Attempts</th>
            <th data-toggle="tooltip" data-placement="top" title="e.g. timeout, wrong answer">Problem is Solved</th>
            </tr>
    </thead>
    <tbody>
            {% for listitem in fail_count_onsite %}
            <tr class='clickableRow' 
                href='team{{listitem.team.pk}}/problem{{listitem.problem.pk}}'>
            <td>{{listitem.team}}</td>
            <td>{{listitem.prev_solved}}</td>
            <td>{{listitem.problem}}</td>
            <td>{{listitem.fail_count}}</td>
            {%if listitem.solved_problem%}
            	<td class ="success">True</td>
            {%else%}
            	<td class="danger">False</td>
            {%endif%}
            {% endfor %}
    </tbody>
</table>

<h3> Unsolved, offsite teams </h3>
<hr />
<table id="tableUnsolved_offsite" class="table table-bordered table-hover table-condensed tablesorter">
	<thead>
            <tr>
            <th data-toggle="tooltip" data-placement="top" title="The team this regards">Team</th>
            <th data-toggle="tooltip" data-placement="top" title="">Previously Solved Assignments</th>
            <th data-toggle="tooltip" data-placement="top" title="What problem this is about">Problem</th>
            <th data-toggle="tooltip" data-placement="top" title="Number of failed attempts">Failed Attempts</th>
            <th data-toggle="tooltip" data-placement="top" title="e.g. timeout, wrong answer">Problem is Solved</th>
            <th data-toggle="tooltip" data-placement="top" title="e.g. timeout, wrong answer">Site-location</th>
            </tr>
    </thead>
    <tbody>
            {% for listitem in fail_count_offsite %}
            <tr class='clickableRow' 
                href='team{{listitem.team.pk}}/problem{{listitem.problem.pk}}'>
            <td>{{listitem.team}}</td>
            <td>{{listitem.prev_solved}}</td>
            <td>{{listitem.problem}}</td>
            <td>{{listitem.fail_count}}</td>
            {%if listitem.solved_problem%}
            	<td class ="success">True</td>
            {%else%}
            	<td class="danger">False</td>
            {%endif%}
            <td>{{listitem.site_location}}</td>
            {% endfor %}
    </tbody>
</table>
<br />


<h3> Solved </h3>
<hr />
<table id="tableSolved" class="table table-bordered table-hover table-condensed tablesorter">
	<thead>
            <tr>
            <th data-toggle="tooltip" data-placement="top" title="The team this regards">Problem</th>
            <th data-toggle="tooltip" data-placement="top" title="">Failed attempts</th>
            <th data-toggle="tooltip" data-placement="top" title="What problem this is about">Successfull attempts</th>
            <th data-toggle="tooltip" data-placement="top" title="What problem this is about">Total</th>
            <th data-toggle="tooltip" data-placement="top" title="What problem this is about">Success/Failed Ratio</th>
            </tr>
    </thead>
    <tbody>
            {% for listitem in prob_attempt_counts %}
            <tr >
            <td>{{listitem.problem}}</td>
            <td>{{listitem.failed}}</td>
            <td>{{listitem.successfull}}</td>
            <td>{{listitem.total}}</td>
            <td>{{listitem.success_ratio}}</td>
        </tr>
            {% endfor %}
    </tbody>
</table>
<br />


<h2> Select team to inspect </h2>
<hr>
<select name="something" onchange="updateText()">
 <option value = ''> Choose Manager </option>
 {% for team in team_list %}
 <option value = "team{{ team.pk}}">{{team.name}}</option>
 {% endfor %}
</select>

<br />
<br />

<script>
$(document).ready(function() 
    { 
        if ($("#tableUnsolved_onsite").find("tr").size() > 1)
        {
            $("#tableUnsolved_onsite").tablesorter( {sortList: [[3,1]], cssAsc: "", cssDesc: "", cssHeader: "",} ); 
        }
        if ($("#tableUnsolved_offsite").find("tr").size() > 1)
        {
            $("#tableUnsolved_offsite").tablesorter( {sortList: [[3,1]], cssAsc: "", cssDesc: "", cssHeader: "",} ); 
        }
        if ($("tableSolved").find("tr").size() > 1)
        {
            $("#tableSolved").tablesorter( {sortList: [[0,0]], cssAsc: "", cssDesc: "", cssHeader: "",} ); 
        }

        $(".clickableRow").click(function() {
        	window.document.location = $(this).attr("href");
      	});

    } 
); 

    function updateText()
    {
        window.document.location = $('select[name="something"] option:selected').val()
    }
</script>



{% endblock content %}
